%function [U,D,H] = diag3D2(A,B,delta,jz)

%This script creates and diagonalizes the matrix H


%The following code was generated with ToMatlab (Google it)


H(:,:,1,1) = 1i*(a-b-2i*jz);
H(:,:,1,2) = A+conj(B);
H(:,:,1,3) = 1i*(a+b);
H(:,:,1,4) = -A+2i*d+conj(B);

H(:,:,2,1) = B+conj(A);
H(:,:,2,2) = -1i*(a-b+2i*jz);
H(:,:,2,3) = -B+conj(A)-2i*conj(d);
H(:,:,2,4) = 1i*(a+b);

H(:,:,3,1) = 1i*(a+b);
H(:,:,3,2) = A+2i*d-conj(B); 
H(:,:,3,3) = 1i*(a-b+2i*jz);
H(:,:,3,4) = -A-conj(B);   

H(:,:,4,1) = B-conj(A)-2i*conj(d);
H(:,:,4,2) = 1i*(a+b); 
H(:,:,4,3) = -B-conj(A);
H(:,:,4,4) = 1i*(-a+b+2i*jz);  


H  = H/2;


em = 4*((-1/8).*a.^2+(-1/8).*b.^2+(1/4).*jz.^2+(1/8).*A.*conj(A)+(1/8).* ...
  B.*conj(B)+(1/4).*d.*conj(d)+(-1/32).*((4.*a.^2+4.*b.^2+(-8).* ...
  jz.^2+(-4).*A.*conj(A)+(-4).*B.*conj(B)+(-8).*d.*conj(d)).^2+(-64) ...
  .*(a.^2.*b.^2+2.*a.*B.*d.*jz+(-2).*a.*b.*jz.^2+(-1).*A.*B.*jz.^2+ ...
  jz.^4+(-1).*A.*b.^2.*conj(A)+(-1).*B.*d.^2.*conj(A)+2.*b.*d.*jz.* ...
  conj(A)+(-1).*a.^2.*B.*conj(B)+A.*B.*conj(A).*conj(B)+(-1).* ...
  jz.^2.*conj(A).*conj(B)+2.*a.*b.*d.*conj(d)+(-2).*A.*b.*jz.*conj( ...
  d)+2.*d.*jz.^2.*conj(d)+(-2).*a.*jz.*conj(B).*conj(d)+d.^2.*conj( ...
  d).^2+(-1).*A.*conj(B).*conj(d).^2)).^(1/2)).^(1/2)/2;
  
ep = 4*((-1/8).*a.^2+ ...
  (-1/8).*b.^2+(1/4).*jz.^2+(1/8).*A.*conj(A)+(1/8).*B.*conj(B)+( ...
  1/4).*d.*conj(d)+(1/32).*((4.*a.^2+4.*b.^2+(-8).*jz.^2+(-4).*A.* ...
  conj(A)+(-4).*B.*conj(B)+(-8).*d.*conj(d)).^2+(-64).*(a.^2.*b.^2+ ...
  2.*a.*B.*d.*jz+(-2).*a.*b.*jz.^2+(-1).*A.*B.*jz.^2+jz.^4+(-1).*A.* ...
  b.^2.*conj(A)+(-1).*B.*d.^2.*conj(A)+2.*b.*d.*jz.*conj(A)+(-1).* ...
  a.^2.*B.*conj(B)+A.*B.*conj(A).*conj(B)+(-1).*jz.^2.*conj(A).* ...
  conj(B)+2.*a.*b.*d.*conj(d)+(-2).*A.*b.*jz.*conj(d)+2.*d.*jz.^2.* ...
  conj(d)+(-2).*a.*jz.*conj(B).*conj(d)+d.^2.*conj(d).^2+(-1).*A.* ...
  conj(B).*conj(d).^2)).^(1/2)).^(1/2)/2;


D(:,:,1,1) = em;
D(:,:,2,2) = ep;
D(:,:,3,3) = -em;
D(:,:,4,4) = -ep;

%The eigenvectors with positive eigenvalues em < ep

vm(:,:,1) = (B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+ ...
  A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))+(sqrt(-1)* ...
  64).*(a+b).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d))).^(-1).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).^(-1).*((-1/64).*(A+conj(B)).*(B+(-1).*conj(A) ...
  +(sqrt(-1)*(-2)).*conj(d))+(-1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*( ...
  -2)).*jz+(sqrt(-1)*(-1)).*2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))+((-1).*(( ...
  -1/64).*(A+conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))+( ...
  -1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*(-2)).*jz+(sqrt(-1)*(-1)).* ...
  2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+ ...
  2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+ ...
  (-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)).^(1/2))).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+ ...
  (-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+ ...
  (sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))+(1/64).*( ...
  (a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).*conj(A)+( ...
  sqrt(-1)*(-2)).*conj(d))).*((sqrt(-1)*(1/64)).*(a+b).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d))+(1/64).*(B+conj(A)).*(sqrt(-1).* ...
  a+(sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))).*((-1).* ...
  (B+conj(A)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1)+( ...
  sqrt(-1)*(-64)).*(a+b).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B) ...
  ).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).^(-1).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1).*((sqrt(-1)*(1/64)).*(a+b) ...
  .*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)) ...
  .*((sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1) ...
  .*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+( ...
  -2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.* ...
  jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.* ...
  conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).* ...
  b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.* ...
  A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)))).*((1/1024).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).* ...
  conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*(B.*conj(A) ...
  +(-1).*conj(d).^2)+(-1).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+( ...
  -1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt( ...
  -1)*(1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).*((sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^( ...
  1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.* ...
  conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))).^(-1);

vm(:,:,2) = (a.^2.*B+(-1).*b.^2.*B+(sqrt(-1)*4).*a.* ...
  B.*jz+a.^2.*conj(A)+(-1).*b.^2.*conj(A)+(-1).*A.*B.*conj(A)+(sqrt( ...
  -1)*(-4)).*B.*d.*conj(A)+(sqrt(-1)*4).*b.*jz.*conj(A)+(-1).*A.* ...
  conj(A).^2+B.^2.*conj(B)+B.*conj(A).*conj(B)+(sqrt(-1)*2).*a.^2.* ...
  conj(d)+(sqrt(-1)*4).*a.*b.*conj(d)+(sqrt(-1)*2).*b.^2.*conj(d)+ ...
  2.*B.*d.*conj(d)+4.*a.*jz.*conj(d)+(-4).*b.*jz.*conj(d)+(sqrt(-1)* ...
  (-2)).*A.*conj(A).*conj(d)+(-2).*d.*conj(A).*conj(d)+(sqrt(-1)*( ...
  -2)).*B.*conj(B).*conj(d)+2.*A.*conj(d).^2+(-2).*conj(B).*conj(d) ...
  .^2+(-1).*B.*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)+conj(A).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+( ...
  -4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)+(sqrt(-1)*2).*conj(d).*(a.^4+(-2).*a.^2.*b.^2+b.^4+ ...
  (-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.* ...
  jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).* ...
  a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.* ...
  A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+( ...
  -8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.* ...
  conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.* ...
  a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(-1).*(a.^2.*B+(-1).* ...
  b.^2.*B+4.*B.*jz.^2+(-1).*a.^2.*conj(A)+b.^2.*conj(A)+(-1).*A.*B.* ...
  conj(A)+4.*jz.^2.*conj(A)+A.*conj(A).^2+B.^2.*conj(B)+(-1).*B.* ...
  conj(A).*conj(B)+2.*B.*d.*conj(d)+4.*a.*jz.*conj(d)+4.*b.*jz.* ...
  conj(d)+2.*d.*conj(A).*conj(d)+2.*A.*conj(d).^2+2.*conj(B).*conj( ...
  d).^2+(-1).*B.*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4) ...
  .*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)+(-1).*conj(A).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).* ...
  a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.* ...
  A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj( ...
  d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.* ...
  conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.* ...
  jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+ ...
  2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).* ...
  conj(d)+2.*A.*conj(d).^2)).^(1/2)+2.*2.^(1/2).*B.*jz.*((-1).*a.^2+ ...
  (-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*( ...
  a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.* ...
  a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+ ...
  B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+( ...
  -4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.* ...
  A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)+2.*2.^(1/2).*jz.*conj(A).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)+2.*2.^(1/2) ...
  .*a.*conj(d).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj( ...
  B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.* ...
  jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.* ...
  jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+( ...
  -8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+ ...
  conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.* ...
  A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj( ...
  B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.* ...
  A.*conj(d).^2)).^(1/2)).^(1/2)+2.*2.^(1/2).*b.*conj(d).*((-1).* ...
  a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1) ...
  .*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+ ...
  8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+ ...
  B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+( ...
  -4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.* ...
  A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2));

vm(:,:,3) = (-1).*((-1).*((-1/64).*(A+conj(B)).*(B+(-1).*conj(A) ...
  +(sqrt(-1)*(-2)).*conj(d))+(-1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*( ...
  -2)).*jz+(sqrt(-1)*(-1)).*2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt( ...
  -1)*(-1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).*(sqrt(-1).*a+(sqrt(-1)*(-1)).*b+(-2).*jz+2.^( ...
  1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.* ...
  conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))+(1/64).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj( ...
  B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*((sqrt(-1)*( ...
  1/64)).*(a+b).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))+(1/64).* ...
  (B+conj(A)).*(sqrt(-1).*a+(sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1) ...
  .*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+( ...
  -1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.* ...
  jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj( ...
  A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj( ...
  d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).* ...
  a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))).*((1/1024).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).* ...
  conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*(B.*conj(A) ...
  +(-1).*conj(d).^2)+(-1).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+( ...
  -1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt( ...
  -1)*(1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).*((sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^( ...
  1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.* ...
  conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))).^(-1);

vm(:,:,4) = 1;

normm = sqrt(1 + abs(vm(:,:,1)).^2 + abs(vm(:,:,2)).^2 + abs(vm(:,:,3)).^2);

vp(:,:,1) = (B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+ ...
  A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+( ...
  -8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.* ...
  jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).* ...
  a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.* ...
  A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+( ...
  -8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.* ...
  conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.* ...
  a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))+(sqrt(-1)*64).* ...
  (a+b).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).*conj( ...
  A)+(sqrt(-1)*(-2)).*conj(d))).^(-1).*(B+(-1).*conj(A)+(sqrt(-1)*( ...
  -2)).*conj(d)).^(-1).*((-1/64).*(A+conj(B)).*(B+(-1).*conj(A)+( ...
  sqrt(-1)*(-2)).*conj(d))+(-1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*(-2) ...
  ).*jz+(sqrt(-1)*(-1)).*2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+ ...
  A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+( ...
  -8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.* ...
  jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).* ...
  a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.* ...
  A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+( ...
  -8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.* ...
  conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.* ...
  a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))+((-1).*(( ...
  -1/64).*(A+conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))+( ...
  -1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*(-2)).*jz+(sqrt(-1)*(-1)).* ...
  2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+ ...
  2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2))).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+(-1/64) ...
  .*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+(sqrt( ...
  -1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+ ...
  A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+( ...
  -8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.* ...
  jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).* ...
  a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.* ...
  A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+( ...
  -8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.* ...
  conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.* ...
  a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))+(1/64).*((a+b) ...
  .^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)* ...
  (-2)).*conj(d))).*((sqrt(-1)*(1/64)).*(a+b).*(B+(-1).*conj(A)+( ...
  sqrt(-1)*(-2)).*conj(d))+(1/64).*(B+conj(A)).*(sqrt(-1).*a+(sqrt( ...
  -1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.* ...
  conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8) ...
  .*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+ ...
  4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.* ...
  conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.* ...
  jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).* ...
  b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj( ...
  d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz) ...
  .*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))).*((-1).*(B+conj(A)) ...
  .*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1)+(sqrt(-1)*(-64) ...
  ).*(a+b).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d))).^(-1).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).^(-1).*((sqrt(-1)*(1/64)).*(a+b).*(B+conj(A))+ ...
  (-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*((sqrt(-1)*( ...
  -1)).*a+sqrt(-1).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))).*(( ...
  1/1024).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d))).*(B.*conj(A)+(-1).*conj(d).^2)+ ...
  (-1).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+(sqrt(-1)*(-1)).* ...
  b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+ ...
  B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.* ...
  d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.* ...
  jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+( ...
  -8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+ ...
  conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.* ...
  A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj( ...
  B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.* ...
  A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt(-1)*(1/64)).*(a+b).*(B+ ...
  conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(( ...
  sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).* ...
  b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).* ...
  a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.* ...
  jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.* ...
  conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).* ...
  b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.* ...
  A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)))).^(-1);

vp(:,:,2) = (a.^2.*B+(-1).*b.^2.*B+(sqrt(-1)*4).*a.*B.* ...
  jz+a.^2.*conj(A)+(-1).*b.^2.*conj(A)+(-1).*A.*B.*conj(A)+(sqrt(-1) ...
  *(-4)).*B.*d.*conj(A)+(sqrt(-1)*4).*b.*jz.*conj(A)+(-1).*A.*conj( ...
  A).^2+B.^2.*conj(B)+B.*conj(A).*conj(B)+(sqrt(-1)*2).*a.^2.*conj( ...
  d)+(sqrt(-1)*4).*a.*b.*conj(d)+(sqrt(-1)*2).*b.^2.*conj(d)+2.*B.* ...
  d.*conj(d)+4.*a.*jz.*conj(d)+(-4).*b.*jz.*conj(d)+(sqrt(-1)*(-2)) ...
  .*A.*conj(A).*conj(d)+(-2).*d.*conj(A).*conj(d)+(sqrt(-1)*(-2)).* ...
  B.*conj(B).*conj(d)+2.*A.*conj(d).^2+(-2).*conj(B).*conj(d).^2+B.* ...
  (a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+ ...
  8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+ ...
  B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+( ...
  -4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.* ...
  A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)+(-1).*conj(A).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+ ...
  (-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)+(sqrt(-1)*(-2)).*conj(d).*(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(-1).*(a.^2.*B+( ...
  -1).*b.^2.*B+4.*B.*jz.^2+(-1).*a.^2.*conj(A)+b.^2.*conj(A)+(-1).* ...
  A.*B.*conj(A)+4.*jz.^2.*conj(A)+A.*conj(A).^2+B.^2.*conj(B)+(-1).* ...
  B.*conj(A).*conj(B)+2.*B.*d.*conj(d)+4.*a.*jz.*conj(d)+4.*b.*jz.* ...
  conj(d)+2.*d.*conj(A).*conj(d)+2.*A.*conj(d).^2+2.*conj(B).*conj( ...
  d).^2+B.*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)+conj(A).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+( ...
  -4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)+2.*2.^(1/2).*B.*jz.*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)+2.*2.^(1/2) ...
  .*jz.*conj(A).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj( ...
  B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+( ...
  -4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)).^(1/2)+2.*2.^(1/2).*a.*conj(d).*((-1).*a.^2+(-1).* ...
  b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).* ...
  a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.* ...
  jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.* ...
  conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).* ...
  b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.* ...
  A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)+2.*2.^(1/2).*b.*conj(d).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2));

vp(:,:,3) = (-1).*(( ...
  -1).*((-1/64).*(A+conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).* ...
  conj(d))+(-1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*(-2)).*jz+(sqrt(-1)* ...
  (-1)).*2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.* ...
  conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.* ...
  jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.* ...
  jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+( ...
  -8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+ ...
  conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.* ...
  A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj( ...
  B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.* ...
  A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt(-1)*(-1/64)).*(a+b).*(B+ ...
  conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*( ...
  sqrt(-1).*a+(sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1) ...
  .*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).* ...
  a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.* ...
  jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.* ...
  conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).* ...
  b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.* ...
  A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)))+(1/64).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)) ...
  .*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*((sqrt(-1)*(1/64)) ...
  .*(a+b).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))+(1/64).*(B+ ...
  conj(A)).*(sqrt(-1).*a+(sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).* ...
  a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+( ...
  a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.* ...
  a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+ ...
  B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+( ...
  -4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.* ...
  A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)))).*((1/1024).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).* ...
  conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*(B.*conj(A) ...
  +(-1).*conj(d).^2)+(-1).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+( ...
  -1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt( ...
  -1)*(1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).*((sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^( ...
  1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.* ...
  conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.* ...
  jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj( ...
  A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj( ...
  d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).* ...
  a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))).^(-1);

vp(:,:,4) = 1;
  
normp = sqrt(1 + abs(vp(:,:,1)).^2 + abs(vp(:,:,2)).^2 + abs(vp(:,:,3)).^2);

%Now take k to -k
A=conj(A); B=conj(B); d = conj(d); a=conj(a); b=conj(b);

vm2(:,:,1) = (B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+ ...
  A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))+(sqrt(-1)* ...
  64).*(a+b).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d))).^(-1).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).^(-1).*((-1/64).*(A+conj(B)).*(B+(-1).*conj(A) ...
  +(sqrt(-1)*(-2)).*conj(d))+(-1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*( ...
  -2)).*jz+(sqrt(-1)*(-1)).*2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))+((-1).*(( ...
  -1/64).*(A+conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))+( ...
  -1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*(-2)).*jz+(sqrt(-1)*(-1)).* ...
  2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+ ...
  2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+ ...
  (-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)).^(1/2))).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+ ...
  (-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+ ...
  (sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))+(1/64).*( ...
  (a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).*conj(A)+( ...
  sqrt(-1)*(-2)).*conj(d))).*((sqrt(-1)*(1/64)).*(a+b).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d))+(1/64).*(B+conj(A)).*(sqrt(-1).* ...
  a+(sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))).*((-1).* ...
  (B+conj(A)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1)+( ...
  sqrt(-1)*(-64)).*(a+b).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B) ...
  ).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).^(-1).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1).*((sqrt(-1)*(1/64)).*(a+b) ...
  .*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)) ...
  .*((sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1) ...
  .*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+( ...
  -2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.* ...
  jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.* ...
  conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).* ...
  b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.* ...
  A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)))).*((1/1024).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).* ...
  conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*(B.*conj(A) ...
  +(-1).*conj(d).^2)+(-1).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+( ...
  -1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt( ...
  -1)*(1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).*((sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^( ...
  1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.* ...
  conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))).^(-1);

vm2(:,:,2) = (a.^2.*B+(-1).*b.^2.*B+(sqrt(-1)*4).*a.* ...
  B.*jz+a.^2.*conj(A)+(-1).*b.^2.*conj(A)+(-1).*A.*B.*conj(A)+(sqrt( ...
  -1)*(-4)).*B.*d.*conj(A)+(sqrt(-1)*4).*b.*jz.*conj(A)+(-1).*A.* ...
  conj(A).^2+B.^2.*conj(B)+B.*conj(A).*conj(B)+(sqrt(-1)*2).*a.^2.* ...
  conj(d)+(sqrt(-1)*4).*a.*b.*conj(d)+(sqrt(-1)*2).*b.^2.*conj(d)+ ...
  2.*B.*d.*conj(d)+4.*a.*jz.*conj(d)+(-4).*b.*jz.*conj(d)+(sqrt(-1)* ...
  (-2)).*A.*conj(A).*conj(d)+(-2).*d.*conj(A).*conj(d)+(sqrt(-1)*( ...
  -2)).*B.*conj(B).*conj(d)+2.*A.*conj(d).^2+(-2).*conj(B).*conj(d) ...
  .^2+(-1).*B.*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)+conj(A).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+( ...
  -4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)+(sqrt(-1)*2).*conj(d).*(a.^4+(-2).*a.^2.*b.^2+b.^4+ ...
  (-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.* ...
  jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).* ...
  a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.* ...
  A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+( ...
  -8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.* ...
  conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.* ...
  a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(-1).*(a.^2.*B+(-1).* ...
  b.^2.*B+4.*B.*jz.^2+(-1).*a.^2.*conj(A)+b.^2.*conj(A)+(-1).*A.*B.* ...
  conj(A)+4.*jz.^2.*conj(A)+A.*conj(A).^2+B.^2.*conj(B)+(-1).*B.* ...
  conj(A).*conj(B)+2.*B.*d.*conj(d)+4.*a.*jz.*conj(d)+4.*b.*jz.* ...
  conj(d)+2.*d.*conj(A).*conj(d)+2.*A.*conj(d).^2+2.*conj(B).*conj( ...
  d).^2+(-1).*B.*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4) ...
  .*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)+(-1).*conj(A).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).* ...
  a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.* ...
  A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj( ...
  d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.* ...
  conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.* ...
  jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+ ...
  2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).* ...
  conj(d)+2.*A.*conj(d).^2)).^(1/2)+2.*2.^(1/2).*B.*jz.*((-1).*a.^2+ ...
  (-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*( ...
  a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.* ...
  a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+ ...
  B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+( ...
  -4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.* ...
  A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)+2.*2.^(1/2).*jz.*conj(A).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)+2.*2.^(1/2) ...
  .*a.*conj(d).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj( ...
  B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.* ...
  jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.* ...
  jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+( ...
  -8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+ ...
  conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.* ...
  A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj( ...
  B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.* ...
  A.*conj(d).^2)).^(1/2)).^(1/2)+2.*2.^(1/2).*b.*conj(d).*((-1).* ...
  a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1) ...
  .*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+ ...
  8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+ ...
  B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+( ...
  -4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.* ...
  A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2));

vm2(:,:,3) = (-1).*((-1).*((-1/64).*(A+conj(B)).*(B+(-1).*conj(A) ...
  +(sqrt(-1)*(-2)).*conj(d))+(-1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*( ...
  -2)).*jz+(sqrt(-1)*(-1)).*2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt( ...
  -1)*(-1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).*(sqrt(-1).*a+(sqrt(-1)*(-1)).*b+(-2).*jz+2.^( ...
  1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.* ...
  conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))+(1/64).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj( ...
  B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*((sqrt(-1)*( ...
  1/64)).*(a+b).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))+(1/64).* ...
  (B+conj(A)).*(sqrt(-1).*a+(sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1) ...
  .*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+( ...
  -1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.* ...
  jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj( ...
  A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj( ...
  d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).* ...
  a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))).*((1/1024).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).* ...
  conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*(B.*conj(A) ...
  +(-1).*conj(d).^2)+(-1).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+( ...
  -1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(-1).*(a.^4+(-2).*a.^2.* ...
  b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4) ...
  .*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+( ...
  -4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj( ...
  d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt( ...
  -1)*(1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).*((sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^( ...
  1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.* ...
  conj(d)+(-1).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))).^(-1);

vm2(:,:,4) = 1;

normm2 = sqrt(1 + abs(vm2(:,:,1)).^2 + abs(vm2(:,:,2)).^2 + abs(vm2(:,:,3)).^2);

vp2(:,:,1) = (B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+ ...
  A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+( ...
  -8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.* ...
  jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).* ...
  a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.* ...
  A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+( ...
  -8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.* ...
  conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.* ...
  a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))+(sqrt(-1)*64).* ...
  (a+b).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).*conj( ...
  A)+(sqrt(-1)*(-2)).*conj(d))).^(-1).*(B+(-1).*conj(A)+(sqrt(-1)*( ...
  -2)).*conj(d)).^(-1).*((-1/64).*(A+conj(B)).*(B+(-1).*conj(A)+( ...
  sqrt(-1)*(-2)).*conj(d))+(-1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*(-2) ...
  ).*jz+(sqrt(-1)*(-1)).*2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+ ...
  A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+( ...
  -8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.* ...
  jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).* ...
  a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.* ...
  A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+( ...
  -8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.* ...
  conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.* ...
  a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))+((-1).*(( ...
  -1/64).*(A+conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))+( ...
  -1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*(-2)).*jz+(sqrt(-1)*(-1)).* ...
  2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+ ...
  2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2))).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+(-1/64) ...
  .*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+(sqrt( ...
  -1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+ ...
  A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+( ...
  -8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.* ...
  jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).* ...
  a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.* ...
  A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+( ...
  -8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.* ...
  conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.* ...
  a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))+(1/64).*((a+b) ...
  .^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)* ...
  (-2)).*conj(d))).*((sqrt(-1)*(1/64)).*(a+b).*(B+(-1).*conj(A)+( ...
  sqrt(-1)*(-2)).*conj(d))+(1/64).*(B+conj(A)).*(sqrt(-1).*a+(sqrt( ...
  -1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.* ...
  conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8) ...
  .*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+ ...
  4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.* ...
  conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.* ...
  jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).* ...
  b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj( ...
  d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz) ...
  .*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))).*((-1).*(B+conj(A)) ...
  .*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).^(-1)+(sqrt(-1)*(-64) ...
  ).*(a+b).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d))).^(-1).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).^(-1).*((sqrt(-1)*(1/64)).*(a+b).*(B+conj(A))+ ...
  (-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*((sqrt(-1)*( ...
  -1)).*a+sqrt(-1).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)))).*(( ...
  1/1024).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d))).*(B.*conj(A)+(-1).*conj(d).^2)+ ...
  (-1).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).* ...
  conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+(sqrt(-1)*(-1)).* ...
  b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+ ...
  B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.* ...
  d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.* ...
  jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+( ...
  -8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+ ...
  conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.* ...
  A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj( ...
  B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.* ...
  A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt(-1)*(1/64)).*(a+b).*(B+ ...
  conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(( ...
  sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^(1/2).*((-1).*a.^2+(-1).* ...
  b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).* ...
  a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.* ...
  jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.* ...
  conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).* ...
  b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.* ...
  A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)))).^(-1);

vp2(:,:,2) = (a.^2.*B+(-1).*b.^2.*B+(sqrt(-1)*4).*a.*B.* ...
  jz+a.^2.*conj(A)+(-1).*b.^2.*conj(A)+(-1).*A.*B.*conj(A)+(sqrt(-1) ...
  *(-4)).*B.*d.*conj(A)+(sqrt(-1)*4).*b.*jz.*conj(A)+(-1).*A.*conj( ...
  A).^2+B.^2.*conj(B)+B.*conj(A).*conj(B)+(sqrt(-1)*2).*a.^2.*conj( ...
  d)+(sqrt(-1)*4).*a.*b.*conj(d)+(sqrt(-1)*2).*b.^2.*conj(d)+2.*B.* ...
  d.*conj(d)+4.*a.*jz.*conj(d)+(-4).*b.*jz.*conj(d)+(sqrt(-1)*(-2)) ...
  .*A.*conj(A).*conj(d)+(-2).*d.*conj(A).*conj(d)+(sqrt(-1)*(-2)).* ...
  B.*conj(B).*conj(d)+2.*A.*conj(d).^2+(-2).*conj(B).*conj(d).^2+B.* ...
  (a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+ ...
  8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+ ...
  B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+( ...
  -4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.* ...
  A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)+(-1).*conj(A).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+ ...
  (-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)+(sqrt(-1)*(-2)).*conj(d).*(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(-1).*(a.^2.*B+( ...
  -1).*b.^2.*B+4.*B.*jz.^2+(-1).*a.^2.*conj(A)+b.^2.*conj(A)+(-1).* ...
  A.*B.*conj(A)+4.*jz.^2.*conj(A)+A.*conj(A).^2+B.^2.*conj(B)+(-1).* ...
  B.*conj(A).*conj(B)+2.*B.*d.*conj(d)+4.*a.*jz.*conj(d)+4.*b.*jz.* ...
  conj(d)+2.*d.*conj(A).*conj(d)+2.*A.*conj(d).^2+2.*conj(B).*conj( ...
  d).^2+B.*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).* ...
  a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.* ...
  conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.* ...
  conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2) ...
  .*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)+conj(A).*(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+( ...
  -4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)+2.*2.^(1/2).*B.*jz.*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2)+2.*2.^(1/2) ...
  .*jz.*conj(A).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj( ...
  B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+( ...
  -4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+ ...
  A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.* ...
  b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A) ...
  .*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+ ...
  ((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*( ...
  a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj( ...
  d).^2)).^(1/2)).^(1/2)+2.*2.^(1/2).*a.*conj(d).*((-1).*a.^2+(-1).* ...
  b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).* ...
  a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.* ...
  jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.* ...
  conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).* ...
  b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.* ...
  A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)+2.*2.^(1/2).*b.*conj(d).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2));

vp2(:,:,3) = (-1).*(( ...
  -1).*((-1/64).*(A+conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).* ...
  conj(d))+(-1/64).*(a+b).*(a+(-1).*b+(sqrt(-1)*(-2)).*jz+(sqrt(-1)* ...
  (-1)).*2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.* ...
  conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.* ...
  jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.* ...
  jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+( ...
  -8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+ ...
  conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.* ...
  A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj( ...
  B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.* ...
  A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt(-1)*(-1/64)).*(a+b).*(B+ ...
  conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*( ...
  sqrt(-1).*a+(sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1) ...
  .*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).* ...
  a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.* ...
  jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.* ...
  conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).* ...
  b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.* ...
  A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)))+(1/64).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).*conj(B)) ...
  .*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*((sqrt(-1)*(1/64)) ...
  .*(a+b).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))+(1/64).*(B+ ...
  conj(A)).*(sqrt(-1).*a+(sqrt(-1)*(-1)).*b+2.*jz+2.^(1/2).*((-1).* ...
  a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+( ...
  a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.* ...
  a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+ ...
  B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+( ...
  -4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.* ...
  A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.* ...
  jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).* ...
  b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^( ...
  1/2)).^(1/2)))).*((1/1024).*((a+b).^2+(A+(sqrt(-1)*2).*d+(-1).* ...
  conj(B)).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d))).*(B.*conj(A) ...
  +(-1).*conj(d).^2)+(-1).*((sqrt(-1)*(-1/64)).*(a+b).*(B+conj(A))+( ...
  -1/64).*(B+(-1).*conj(A)+(sqrt(-1)*(-2)).*conj(d)).*(sqrt(-1).*a+( ...
  sqrt(-1)*(-1)).*b+(-2).*jz+2.^(1/2).*((-1).*a.^2+(-1).*b.^2+2.* ...
  jz.^2+A.*conj(A)+B.*conj(B)+2.*d.*conj(d)+(a.^4+(-2).*a.^2.*b.^2+ ...
  b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.*jz.^2+8.*a.*b.*jz.^2+(-4).* ...
  b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj(A).^2+B.^2.*conj(B).^2+(-4) ...
  .*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj(d)+(-4).*b.^2.*d.*conj(d)+ ...
  8.*A.*b.*jz.*conj(d)+conj(A).*((-2).*a.^2.*A+2.*A.*b.^2+4.*B.* ...
  d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).*A.*B+4.*jz.^2).*conj(B)+4.* ...
  A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+(-1).*b.^2+2.*jz.^2)+2.*(B.* ...
  d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)).^(1/2)).^(1/2))).*((sqrt( ...
  -1)*(1/64)).*(a+b).*(B+conj(A))+(-1/64).*(B+(-1).*conj(A)+(sqrt( ...
  -1)*(-2)).*conj(d)).*((sqrt(-1)*(-1)).*a+sqrt(-1).*b+2.*jz+2.^( ...
  1/2).*((-1).*a.^2+(-1).*b.^2+2.*jz.^2+A.*conj(A)+B.*conj(B)+2.*d.* ...
  conj(d)+(a.^4+(-2).*a.^2.*b.^2+b.^4+(-8).*a.*B.*d.*jz+(-4).*a.^2.* ...
  jz.^2+8.*a.*b.*jz.^2+(-4).*b.^2.*jz.^2+4.*A.*B.*jz.^2+A.^2.*conj( ...
  A).^2+B.^2.*conj(B).^2+(-4).*a.^2.*d.*conj(d)+(-8).*a.*b.*d.*conj( ...
  d)+(-4).*b.^2.*d.*conj(d)+8.*A.*b.*jz.*conj(d)+conj(A).*((-2).* ...
  a.^2.*A+2.*A.*b.^2+4.*B.*d.^2+(-8).*b.*d.*jz+4.*A.*jz.^2+((-2).* ...
  A.*B+4.*jz.^2).*conj(B)+4.*A.*d.*conj(d))+2.*conj(B).*(B.*(a.^2+( ...
  -1).*b.^2+2.*jz.^2)+2.*(B.*d+2.*a.*jz).*conj(d)+2.*A.*conj(d).^2)) ...
  .^(1/2)).^(1/2)))).^(-1);

vp2(:,:,4) = 1;

normp2 = sqrt(1 + abs(vp2(:,:,1)).^2 + abs(vp2(:,:,2)).^2 + abs(vp2(:,:,3)).^2);
  
vm2 = mult4(gamma,conj(vm2));
vp2 = mult4(gamma,conj(vp2));

for m=1:4
    vm(:,:,m) = vm(:,:,m)./normm;
    vp(:,:,m) = vp(:,:,m)./normp;
    vm2(:,:,m)=vm2(:,:,m)./normm2;
    vp2(:,:,m)=vp2(:,:,m)./normp2;
end

U(:,:,:,1) = vm;
U(:,:,:,2) = vp;
U(:,:,:,3) = vm2;
U(:,:,:,4) = vp2;

%U2 = mult4( gamma , mult4(conj(U),gamma) );


